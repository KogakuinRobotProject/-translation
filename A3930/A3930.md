# A3930 and A3931
## 車積載向け3相BLDCコントローラ and  MOSFETドライバー

### 機能と利点
- NchMOSFET用高電流3相ゲート駆動
- 同期整流
- ブリッジショート保護
- 100%PWM対応チャージポンプ
- コミュテーションデコードロジック内蔵
- 5.5V~50V電源範囲対応
- 様々な自己診断機能
- +5Vホールセンサ電源出力
- 低電流スリープモード

### 概要
 A3930とA3931は3相BLDC用NchパワーMOSFETドライバです。コスト効率に優れた3相モータ駆動システムの設計に必要な多くの回路を内蔵しており、特に自動車用途向けに設計されています。<BR>
 主要な自動車要件は、幅広い入力電源範囲にわたる機能性です。独自チャージポンプレギュレータは、7Vまでのバッテリ電圧に対して適切な(>10V)ゲート駆動を提供し、5.5Vまでのバッテリ電圧でゲート駆動を低減して動作させます。チャージポンプの電力損失は、低電源電圧での倍電圧モードから14Vの公称動作電圧でのドロップアウトモードへの切り替え。ブーストラップコンデンサは、NチャネルMOSFETに必要な上記のバッテリ電源電圧を提供するために使用されます。ハイサイド駆動用の内部チャージポンプは、DC(100%デューティーサイクル)動作を可能にします。<BR>
  内部固定周波数PWM電流制御回路を使用して最大負荷電流を調整することができます。ピーク負荷電流制限は、入力基準電圧と外部検出抵抗の洗濯によって設定されます。 PWM周波数は、ユーザが選択した外部RCタイミングネットワークによって設定されます。柔軟性を高めるため、PWM入力を使用して速度とトルクの制御を行い、内部電流制御回路が最大電流制限を設定できるようにします。<BR>
 同期整流を使用することにより効率が向上します。パワーFETは、デッドタイムを伴うクロスオーバ制御によりシュートスルーから保護されています。デッドタイムは、単一の外付け抵抗で設定できます。<BR>
 A3930とA3931は、Hall入力のオールゼロ・コンビネーションに対する応答が異なります。この状態では、A3930は論理フォルトを示しますが、A3931は、マイクロプロセッサで駆動される「センサレス」制御システムの起動アルゴリズムに適した不安定な開始位置にモータをプリセットします。<BR>
両方のデバイスは、露出パッド付きの48ピンLQFPで供給されます。これは、フットプリント（81 mm2）の小型パッケージで、鉛（Pb）フリーで、100％マットスズリードフレームメッキを施しています。<BR>

型番|  オプション |  パッキング |   |  
--|---|---|---|--
 A3930 |   |   |   |  

## 機能説明
### 基本操作
A3930およびA3931デバイスは、統合ホール効果（HE）センサを備えた3相ブラシレスDC（BLDC）モータの整流および電流制御を行います。モータ電流は、固定周波数パルス幅変調（PWM）を使用してA3930 / A3931によって制御される外部3相NチャネルMOSFETブリッジによって供給されます。 NチャネルMOSFETを備えたPWMを使用することにより、高効率モーター駆動に最も費用対効果の高いソリューションが提供されます。<BR>
A3930 / A3931は、7 Vまでの電源電圧で、ハイサイドおよびローサイドの両方の外付けMOSFETのゲート - ソース間電圧が10 Vを超えるようにするために必要なすべての回路を備えています。ゲート駆動を低減しながら、5.5Vまで保証されています。また、A3930 / A3931は、電気サイクルで120°の間隔を置いた3つのHEセンサからコミュテーションシーケンスをデコードし、外部ブリッジでの相互導通（シュートスルー）を防止します。個々のピンは方向、ブレーキ、コースト制御を提供します。<BR>
モータ電流は、ブリッジへのグランド接続の低値検出抵抗RSENSEによって検出され、増幅され、基準値と比較されます。 A3930 / A3931は、サイクルごとにブリッジ電流を制限します。ブリッジ電流は、外部PWM信号を使用して制御することもでき、内部電流制御をディスエーブルにするか、絶対最大モータ電流を設定するのに使用します。特定の機能については、以降のセクションで詳しく説明します。<BR>

### 電源
 すべての内部回路は内蔵レギュレータから給電されるため、電源接続は1つだけ必要です。主電源は、逆バッテリ保護回路を介してVBBに接続する必要があります。

### V5およびV5BD
5Vレギュレータコントローラと外部NPNトランジスタQV5により、外部プルアップ電流とバイアス電流用の5V電源が供給されます。 A3930 / A3931は、V5BDピンのベース駆動電流とV5ピンの5Vリファレンスを提供します。このレギュレータは内部ロジック回路でも使用されるため、V5ピンとAGNDの間に少なくとも200nFのコンデンサCV5でデカップリングする必要があります。安定性のために、100nFのコンデンサ、C5BDもV5BDとAGNDの間に接続する必要があります。外部5V電源が不要な場合は、V5BDピンとV5ピンを一緒に接続する必要があります。<BR>

### CP1,CP2およびVREG
ゲート駆動出力は、内部チャージポンプによって給電されます。これには、CP1ピンとCP2ピンの間に接続された、通常470 nFのCPのポンプコンデンサが必要です。チャージポンプの出力（公称13 V）は、3つのハイサイドとローサイドのドライバペアにそれぞれ電力を供給するために使用され、VREGピンでも使用できます。ローサイド・ドライバに過渡充電電流を供給するには、十分に大きな蓄積コンデンサCREGをこのピンに接続する必要があります。チャージポンプはブートストラップコンデンサCBOOTxの充電電流も供給します。<BR>
各ハイサイド・ドライブに追加の「トップオフ」チャージ・ポンプが備わっているため、ハイサイド・ドライブは外部FETのゲート電圧を無期限に維持し、必要に応じて100％PWMを保証します。これは、低電流トリクルチャージポンプ（<100μAtyp）で、ハイサイドドライバがオンになるように信号が通知された後にのみ動作します。フローティング・ハイサイド回路を動作させるためには、Cxピンからわずかなバイアス電流（<20μA）が流れます。チャージ・ポンプは、ブートストラップ電圧、したがってゲート電圧がこのバイアス電流により垂下する。ハイサイドゲートの最初のターンオンに必要な充電は、常にブートストラップコンデンサの充電サイクルによって供給されます。<BR>

### ホール効果センサ入力
H1、H2、H3ホール効果センサの入力は、120°の電気的間隔のHEセンサを備えたモータ用に構成されていますが、外部インバータとの60°の電気的間隔に使用できます。 HEセンサは、通常、センサ出力と5Vとの間に追加のプルアップ抵抗を接続する必要があります。この5Vは、内蔵5Vレギュレータによって供給できます。 HE入力は、モータへのHE接続におけるスイッチングノイズの影響を低減するために、通常500mVのヒステリシスを備えています。これらの入力は、スイッチングノイズの影響をさらに低減するためにフィルタリングされています。 HE入力は、A3930 / A3931の内部で5Vにプルアップされ、高電圧（100kΩ標準）の抵抗がダイオードと直列に接続されています。この内部プルアップにより、ホールセンサ信号が欠落している場合にHE入力がHighに見えるようになり、HE入力ロジックフォールトの検出が可能になります。<BR>
モーターの既知の始動位置を提供するために、A3931にはオプションの事前位置決め機能があります。ホール入力がすべてローに駆動されると（H1 = H2 = H3 = 0）、A相のパワーFETは電源から電流を供給し、B相とC相の両方の電流FETは電流をシンクします。これにより、モーターは2つの戻り止め点の間の不安定な位置に移動し、回転の正しい初期方向を確実にするための始動アルゴリズムが可能になります。これはA3931でのみ利用可能であることに注意してください。すべてのホール入力がローに駆動されると、A3930は論理フォルトを示します。これらの入力の転流真理値表を表2に示します。入力はマイクロコントローラまたは同様の外部回路から直接駆動することもできます。<BR>

### ゲートドライブ
A3930 / A3931は外部NチャネルパワーMOSFETを駆動するように設計されています。スイッチング時に外部FETの消費電力を低減するために、外部FETのゲート容量を素早く充電および放電するために必要な大きな過渡電流を供給します。充放電レートは、FETのゲートへの接続と直列の外部抵抗を使用して制御することができます。<BR>

### RDEAD
交差導通は、ゲート駆動回路によって防止され、1つのFETをオフに切り換え、相補的にオンにする間にデッドタイムtDEADを導入する。デッドタイムは、RDEADピンとAGNDの間に接続された抵抗RDEADの値から導出されます。 RDEADがV5に接続されている場合、tDEADのデフォルト値は6μsです。

### GLA、GLB、およびGLC
外部NMOSドライバ用のローサイドゲート駆動出力。外部直列ゲート抵抗RGATE（NMOSゲートのできるだけ近く）を使用してパワー・ドライバ・ゲートに見られるスルー・レートを制御し、Sx出力のdi / dtとdv / dtを制御することができます。表2を参照すると、GLx = 1（ハイ）はドライバの上半分（PMOS）がオンになり、ドレインが外部モータ駆動ブリッジのローサイドFETのゲートに電流を供給することを意味します。 GLx = 0（ロー）は、ドライバの下半分（NMOS）がオンになり、ドレインが対応する外部FETゲート回路からLSSピンへ電流をシンクすることを意味します。

### SA、SB、およびSC
モーターに直接接続されたこれらの端子は、負荷を横切ってスイッチされた電圧を検出します。これらの端子は、ブートストラップ・コンデンサの負側にも接続され、フローティング・ハイサイド・ドライバの負電源接続です。ハイサイドのFETのゲート容量からの放電電流は、これらの接続部を通って流れます。これらの接続部は、FETブリッジへの低インピーダンスのトレースを持つ必要があります。

### GHA、GHB、およびGHC
外部NMOSドライバ用のハイサイドゲート駆動出力。外付けの直列ゲート抵抗RGATEを使用してパワー・ドライバ・ゲートに見られるスルー・レートを制御し、Sx入力のdi / dtとdv / dtを制御することができます。表2を参照すると、GHx = 1（ハイ）はドライバの上半分（PMOS）がオンになり、そのドレインが外部モータ駆動ブリッジのハイサイドFETのゲートに電流を供給することを意味します。 GHx = 0（ロー）は、ドライバの下半分（NMOS）がオンになり、ドレインが対応する外部FETゲート回路からそれぞれのSxピンに電流をシンクすることを意味します。

### CA、CB、およびCC
ブートストラップコンデンサのハイサイド接続とハイサイドゲートドライバの正電源。ブートストラップコンデンサCBOOTxは、対応するSx端子が低レベルのときにほぼVREGに充電されます。 Sx出力がハイレベルになると、Cxピンの電圧が出力とともに上昇し、ハイサイドNチャネルパワーMOSFETに必要な昇圧ゲート電圧が得られます。

### VDRAIN
高インピーダンスセンス入力（ケルビン接続）が外部FETブリッジの上部に接続されています。この入力により、ハイサイドFETのドレインの電圧を正確に測定することができ、ハイサイドFETのドレイン接続に近いブリッジに直接接続する必要があります。独立したトレース

### LSS
ゲートコンデンサを放電するためのローサイドのリターンパス。独立した低インピーダンス・トレースを介してローサイドの外部FETの共通ソースに接続されています。

### ロジック制御入力
以下で説明する特定の機能を有効にするために、追加のロジックレベル入力が提供されています。これらのロジック入力はすべてノイズ性能を向上させるために500mVの公称ヒステリシスを備えています。

### リセット
VBB電源からの最小電流消費を可能にします。 RESETがローのとき、V5出力を含むすべての内部回路がディスエーブルされます。スリープ状態から出るとき、保護ロジックは、チャージポンプが適切な動作条件に達するまで、ゲート駆動出力がオフになることを保証する。チャージポンプは、公称条件下で約3msで安定します。 RESETは内部プルダウン抵抗50kΩを標準装備しています。ただし、外部ロジック入力を必要とせずにA3930 / A3931を起動させるには、RESETピンを外部プルアップ抵抗を使ってバッテリ電圧に引き上げることができます。 RESETには入力電流を制限するために6Vの標準的な内部クランプ・ダイオードも内蔵されているため、外付けプルアップ抵抗の値は20kΩ以上にする必要があります。抵抗の上限は、入力電圧が入力ハイスレッショルドVINRに達するのに十分なほど低くなければなりません。

### COAST
電源または制御ロジックをディスエーブルすることなくすべてのFETをオフにするアクティブロー入力。これにより、短絡時に外部FETとモータを保護することができます。

### モード
電流減衰法を設定します。表3を参照すると、低速減衰モードMODE = 1のとき、PWMオフサイクル中にハイサイドMOSFETのみがオフになります。高速減衰モードMODE = 0では、デバイスはハイサイドMOSFETとローサイドMOSFETの両方を切り替えます。低速減衰は、PWM周波数でのモータのリップル電流を低くしますが、電流制御の動的応答を低減します。多かれ少なかれ一定速度で動くモータに適しています。高速減衰は改善された電流制御ダイナミック応答を提供しますが、モータ電流リップルを増加させます。これは、スタートストップおよび位置決めの用途に使用されるモータに適しています。

### DIR
表2に示すように、モータのトルク出力の方向を決定します。無負荷の低慣性モータの場合、通常は機械的な回転の方向になります。慣性負荷の高いモーターでは、DIR入力を使用して、高速減衰（MODE = 0）を使用すると制御された破壊トルクを適用できます。

### ブレーキ
制動機能を提供するアクティブロー入力。 BRAKE = 0のとき（表3参照）、すべてのローサイドFETがオンになり、ハイサイドFETがオフになります。これは巻線の逆起電力を効果的に短絡し、モータを制動します。適用される制動トルクは速度に依存する。 RESET = 0またはCOAST = 0はBRAKEを無効にし、モータをフリーランします。 BRAKEを使用してモータを動的に制動すると、巻線は短絡され、巻線電流を制御することはできません。

### ESF
ESF（enable stop on fault）ピンの状態は、短絡が検出されたときの動作を決定します。詳細については、診断セクションを参照してください。

### テスト
テストはAllegroのプロダクション用であり、AGNDに接続する必要があります。

### 電流規制
負荷電流は、内部固定周波数PWM制御回路またはPWMピンの外部入力によって調整することができます。

### 電流検出アンプ：CSP、CSN、およびCSOUT
電流センス素子として低値のセンス抵抗または電流シャントを使用できるようにするために、代表値19の利得AVを持つ差動電流センスアンプが用意されています。このセンスアンプの出力はCSOUTで利用できるため、内部または外部の電流検出に使用できます。センス抵抗RSENSEをCSPとCSNの間に接続すると、センスアンプの出力はおよそ次のようになります。

ここで、VOOSは出力オフセット電圧（ゼロ負荷電流での電圧）、AVはセンスアンプの差動電圧ゲインです（19）。

### 内部電流制御：REF
最大電流制限を提供するために、固定の基準電圧を印加することができます。可変基準電圧は可変トルク制御を提供する。電流センス差動アンプの出力電圧VCSOUTは、REFピンで利用可能な基準電圧と比較されます。 MOSFETの出力がオンになると、電流がトリップポイント値ITRIPに達するまでモータ巻線の電流が増加します。

トリップポイントでは、センスコンパレータがソースイネーブルラッチをリセットし、ソースドライバをオフにします。この時点で、負荷インダクタンスは、次のPWM周期の開始まで電流を再循環させます。
再循環中の電流経路は、MODEピンの構成によって決まります。したがって、PWM入力がハイのままであれば、REFピンの電圧を変化させることによってトルク制御を実現することができます。 PWM入力によるトルクまたは電流の直接制御が必要な場合は、電圧をREFピンに印加して絶対最大電流制限を設定することができます。 REF入力は内部で4Vに制限されています。これによりV5、RREFへの単純なプルアップ抵抗を使用して最大リファレンス電圧を設定し、外部で生成されたリファレンス電圧が不要になります。 RREFの値は20kΩ〜200kΩにする必要があります。

### 内部PWM周波数
内部発振器周波数fOSCは、RCピンからAGNDに並列に接続された外付け抵抗RTおよびコンデンサCTによって決まります。頻度は約です：

ここで、fOSCは20〜50kHzの範囲です。

### PWM入力
PWMピンの外部制御回路信号によってモータートルクを制御することができます。表3を参照すると、PWM = 0の場合、選択されたドライバはオフにされ、負荷
インダクタンスによって電流が再循環します。再循環中の電流経路は、MODEピンの構成によって決まります。 PWM = 1に設定すると、Hx入力ロジックによって決定された選択されたドライバがオンになります。 PWM = 1を保持すると、REFピンの電圧を使用して、内部電流制限回路のみで速度とトルクを制御することができます。状況によっては、内部PWM制御を完全にディセーブルすることが望ましい場合もあります。これは、RCピンをAGNDに直接プルすることによって実行できます。これにより、内蔵PWM発振器がディスエーブルされ、PWMラッチの出力が常にハイになることが保証されます。

### 空白時間
ソースドライバがオンになると、クランプダイオードの逆回復電流と負荷の分配容量に関連するスイッチングトランジェントによって電流スパイクが発生します。この電流スパイクが誤ってソースイネーブルラッチをリセットしないようにするために、ソースドライバがオンになると、短時間（tBLANK）電流制御コンパレータ出力がブランキングされます。
tBLANKの長さは、内部PWMと外部PWMで異なります。次の式に従って、タイミングコンデンサCTの値によって設定されます。<BR>
内部PWMの場合：tBLANK（μs）= 1260×CT（μF）、および<BR>
外部PWMの場合：tBLANK（μs）= 2000×CT（μF）。<BR>
680 pFの公称CT値は、外部PWMの場合は1.3μs、内部PWMの場合は860 nsのtBLANKを生成します。ユーザは、内部センスアンプを使用する場合、CTが現在のスパイク持続時間をカバーするのに十分な大きさであることを確認する必要があります。

### 診断
A3930 / A3931に組み込まれたいくつかの診断機能は、速度と方向のフィードバックと障害状態の表示を提供します。

### タコとダイロ
これらの出力は、モータからのHE入力に基づいて速度および方向情報を提供します。図1に示すように、各転流点において、TACHO出力はモーターの方向に関係なく状態を変えます。各転流点でDIRO出力が更新され、モータの方向が示されます。モーターが「正方向」または正方向に回転しているとき、DIROは高くなります。回転が「逆」または負の方向にある場合、DIROは低くなります。実際の回転方向は、3つのホール入力Hxのシーケンスから決定されます。順番は、表2を上から下へ、表2が下から上になるときに順序が逆転するときである。<BR>
DIRO出力ピンに報告された方向とDIR入力ピンに要求される方向が同じでない場合があることに注意してください。これは、モーターと負荷の慣性がかなり高い場合に発生する可能性があります。この場合、DIRピンの状態を変更するとトルクが逆転し、モーターを制動します。この制動中、DIRO出力に示された方向は変化しません。
